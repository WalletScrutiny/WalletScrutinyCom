{% comment %}
  custodianFullReview.html

  Consolidates:
    - The "overview" text
    - The "Apps" block
    - The "audit" steps (hot/cold design, proofOfReserves, etc.)
    - The timeline style for circles on the left
    - The .step / .developer structure
  Expects:
    - include.custodian (all data under custodian.* in front matter)
    - include.platformReview (optional if you want app store links, etc.)
{% endcomment %}

{% assign custodian = include.custodian %}
{% assign platformReview = include.platformReview %}

<!-- Introduction / Overview -->
<h2>Custodian Scrutiny</h2>
<p>
  We conduct a comprehensive analysis of bitcoin custodians across multiple critical dimensions.
  Our evaluation examines their security infrastructure (hot/cold storage design, proof of reserves),
  operational focus (bitcoin-only vs multi-coin), business practices (leadership, jurisdiction,
  track record), ecosystem contributions (FOSS development, protocol adoption), and user protection
  measures (KYC requirements, security features, custody model). This thorough assessment helps
  users make informed decisions about which custodians best align with their security needs
  and bitcoin values.
</p>

<!-- Apps Section -->
<h2>Apps</h2>
<div class="see-also">
  {% if custodian.androidApp %}
    <a href="{{ custodian.androidApp.url }}" class="app-link">
      <div class="app-content">
        <i class="fab fa-android"></i>
        <span class="app-name">{{ custodian.androidApp.name }}</span>
      </div>
      <div class="app-store">Google Play</div>
    </a>
  {% endif %}
  
  {% if custodian.iphoneApp %}
    <a href="{{ custodian.iphoneApp.url }}" class="app-link">
      <div class="app-content">
        <i class="fab fa-apple"></i>
        <span class="app-name">{{ custodian.iphoneApp.name }}</span>
      </div>
      <div class="app-store">App Store</div>
    </a>
  {% endif %}
  
  {% if custodian.webApp %}
    <a href="{{ custodian.webApp.url }}" class="app-link">
      <div class="app-content">
        <i class="fas fa-globe"></i>
        <span class="app-name">{{ custodian.webApp.name }}</span>
      </div>
      <div class="app-store">Web</div>
    </a>
  {% endif %}

  {% if custodian.browserExtension %}
    <a href="{{ custodian.browserExtension.url }}" class="app-link">
      <div class="app-content">
        <i class="fab fa-chrome"></i>
        <span class="app-name">{{ custodian.browserExtension.name }}</span>
      </div>
      <div class="app-store">Chrome Extension</div>
    </a>
  {% endif %}
  
  {% if custodian.desktopApp %}
    <a href="{{ custodian.desktopApp.url }}" class="app-link">
      <div class="app-content">
        <i class="fas fa-desktop"></i>
        <span class="app-name">{{ custodian.desktopApp.name }}</span>
      </div>
      <div class="app-store">Desktop App</div>
    </a>
  {% endif %}
</div>

<hr />

<!-- Timeline / Audit Steps -->
<!-- HOT/COLD Design -->
<div class="step developer">
  <i class="fa fa-server circle storage"></i>
  <div class="title">
    <h3>Do they publish their hot wallet and cold storage design and processes?</h3>
    <div class="textbox">
      <div class="status {% if custodian.hotColdDesign.published %}published{% else %}not-published{% endif %}">
        {% if custodian.hotColdDesign.published %}
          <i class="fas fa-check"></i> Design Published
        {% else %}
          <i class="fas fa-times"></i> Design Not Published
        {% endif %}
      </div>
      <div class="last-updated">
        Last Updated: {{ custodian.hotColdDesign.lastUpdated }}
      </div>
      <div class="details">
        {{ custodian.hotColdDesign.details }}
      </div>
      {% if custodian.hotColdDesign.documentation_url %}
        <a href="{{ custodian.hotColdDesign.documentation_url }}" class="docs-link">
          <i class="fas fa-external-link-alt"></i> View Documentation
        </a>
      {% endif %}
    </div>
  </div>
</div>

<!-- BITCOIN FOCUS -->
<div class="step developer">
  <i class="fab fa-bitcoin circle bitcoin"></i>
  <div class="title">
    <h3>Is it bitcoin-only/bitcoin-optimized?</h3>
    <div class="textbox">
      <div class="bitcoin-status">
        {% if custodian.bitcoinFocus.bitcoinOnly %}
          <span class="badge bitcoin-only">Bitcoin Only</span>
        {% elsif custodian.bitcoinFocus.bitcoinOptimized %}
          <span class="badge bitcoin-optimized">Bitcoin Optimized</span>
        {% endif %}
      </div>
      {% comment %} Example: supportedAssets, bitcoinFeatures, details {% endcomment %}
      {% if custodian.bitcoinFocus.supportedAssets %}
        <div class="supported-assets">
          <h4>Supported Assets</h4>
          <ul>
            {% for asset in custodian.bitcoinFocus.supportedAssets %}
              <li>{{ asset }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      {% if custodian.bitcoinFocus.bitcoinFeatures %}
        <div class="bitcoin-features">
          <h4>Bitcoin Features</h4>
          <ul>
            {% for feature in custodian.bitcoinFocus.bitcoinFeatures %}
              <li>{{ feature }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      <div class="details">
        {{ custodian.bitcoinFocus.details }}
      </div>
    </div>
  </div>
</div>

<!-- PROOF OF RESERVES -->
<div class="step developer">
  <i class="fas fa-file-alt circle reserves"></i>
  <div class="title">
    <h3>Do they provide proof of reserves?</h3>
    <div class="textbox">
      <div class="status {% if custodian.proofOfReserves.supported %}supported{% else %}not-supported{% endif %}">
        {% if custodian.proofOfReserves.supported %}
          <i class="fas fa-check"></i> Supported
          {% if custodian.proofOfReserves.frequency %}
            <div class="frequency">Updated {{ custodian.proofOfReserves.frequency }}</div>
          {% endif %}
          {% if custodian.proofOfReserves.lastProof %}
            <div class="last-proof">Last Proof: {{ custodian.proofOfReserves.lastProof }}</div>
          {% endif %}
        {% else %}
          <i class="fas fa-times"></i> Not Supported
        {% endif %}
      </div>
      {% if custodian.proofOfReserves.verificationUrl %}
        <a href="{{ custodian.proofOfReserves.verificationUrl }}" class="verify-link">
          <i class="fas fa-external-link-alt"></i> Verify Reserves
        </a>
      {% endif %}
      <div class="details">
        {{ custodian.proofOfReserves.details }}
      </div>
    </div>
  </div>
</div>

<!-- LEADERSHIP -->
<div class="step developer">
  <i class="fas fa-globe circle leadership"></i>
  <div class="title">
    <h3>Where is the company located and who are the key team members?</h3>
    <div class="textbox">
      <div class="jurisdiction">
        <strong>Jurisdiction:</strong> {{ custodian.leadership.jurisdiction }}
      </div>
      {% if custodian.leadership.yearsInBusiness %}
        <div class="years">
          <strong>Years in Business:</strong> {{ custodian.leadership.yearsInBusiness }}
        </div>
      {% endif %}
      {% if custodian.leadership.team %}
        <div class="team">
          <h4>Leadership Team</h4>
          <ul>
            {% for member in custodian.leadership.team %}
              <li>{{ member.name }} - {{ member.role }}{% if member.location %} ({{ member.location }}){% endif %}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- OPERATIONS -->
<div class="step developer">
  <i class="fas fa-cogs circle operations"></i>
  <div class="title">
    <h3>What is the operational history and incident track record?</h3>
    <div class="textbox">
      {% if custodian.operations.btcCustodied %}
        <div class="btc-custodied">
          <strong>BTC in Custody:</strong> {{ custodian.operations.btcCustodied }}
        </div>
      {% endif %}
      <div class="track-record">
        <h4>Incident History</h4>
        {% if custodian.operations.trackRecord %}
          <div class="history">{{ custodian.operations.trackRecord }}</div>
        {% endif %}
        {% if custodian.operations.incidentHistory %}
          <div class="history">{{ custodian.operations.incidentHistory }}</div>
        {% endif %}
        {% if custodian.operations.lastIncident %}
          <div class="last-incident">Last Incident: {{ custodian.operations.lastIncident }}</div>
        {% endif %}
      </div>
      {% if custodian.operations.insuranceCoverage %}
        <div class="insurance-coverage">
          <strong>Insurance Coverage:</strong> {{ custodian.operations.insuranceCoverage }}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- BUSINESS MODEL -->
<div class="step developer">
  <i class="fas fa-briefcase circle business"></i>
  <div class="title">
    <h3>What is the business model and revenue stream?</h3>
    <div class="textbox">
      {% if custodian.businessModel.type %}
        <p><strong>Type:</strong> {{ custodian.businessModel.type }}</p>
      {% endif %}
      {% if custodian.businessModel.services %}
        <div class="services">
          <h4>Services Offered</h4>
          <ul>
            {% for service in custodian.businessModel.services %}
              <li>{{ service }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      {% if custodian.businessModel.restrictedCountries %}
        <div class="restrictions">
          <h4>Restricted Countries</h4>
          <ul>
            {% for country in custodian.businessModel.restrictedCountries %}
              <li>{{ country }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- BITCOIN CONTRIBUTION -->
<div class="step developer">
  <i class="fab fa-bitcoin circle ecosystem"></i>
  <div class="title">
    <h3>What is the contribution to the Bitcoin ecosystem?</h3>
    <div class="textbox">
      <div class="contributions">
        <ul>
          <li class="{% if custodian.bitcoinContribution.fossDevelopment %}active{% endif %}">
            FOSS Development
          </li>
          <li class="{% if custodian.bitcoinContribution.protocolSupport %}active{% endif %}">
            Protocol Support
          </li>
          <li class="{% if custodian.bitcoinContribution.research %}active{% endif %}">
            Research
          </li>
        </ul>
      </div>
      <div class="details">{{ custodian.bitcoinContribution.details }}</div>
    </div>
  </div>
</div>

<!-- USER ACCESS -->
<div class="step developer">
  <i class="fas fa-user-circle circle access"></i>
  <div class="title">
    <h3>What are the user access requirements and restrictions?</h3>
    <div class="textbox">
      <div class="kyc">
        <strong>KYC Required:</strong> {{ custodian.userAccess.kycRequired }}
        {% if custodian.userAccess.kycRequired %}
          <div class="kyc-level">Level: {{ custodian.userAccess.kycLevel }}</div>
        {% endif %}
      </div>
      {% if custodian.userAccess.withdrawalLimits %}
        <div class="limits">
          <h4>Withdrawal Limits</h4>
          <ul>
            {% if custodian.userAccess.withdrawalLimits.daily %}
              <li>Daily: {{ custodian.userAccess.withdrawalLimits.daily }}</li>
            {% endif %}
            {% if custodian.userAccess.withdrawalLimits.monthly %}
              <li>Monthly: {{ custodian.userAccess.withdrawalLimits.monthly }}</li>
            {% endif %}
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- SECURITY FEATURES -->
<div class="step developer">
  <i class="fas fa-lock circle security"></i>
  <div class="title">
    <h3>What are the security features and measures in place?</h3>
    <div class="textbox">
      {% if custodian.security.features %}
        <div class="features">
          <ul>
            {% for feature in custodian.security.features %}
              <li>{{ feature }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      {% if custodian.security.customInfrastructure %}
        <div class="infrastructure">
          <strong>Custom Infrastructure:</strong> 
          {% if custodian.security.customInfrastructure == true %}
            Yes
          {% else %}
            No (Outsourced)
          {% endif %}
        </div>
      {% endif %}
      {% if custodian.security.details %}
        <div class="details">{{ custodian.security.details }}</div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Add any final or “seeAlso” blocks if needed -->

<!-- STYLES: merged from your old partials to preserve the vertical timeline -->
<style>
.custodian-full-review {
  max-width: 900px;
  margin: 2rem auto;
}

/* The grid for the big icon + heading */
.app-summary-grid {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 2rem;
  align-items: center;
  margin-bottom: 2rem;
}

.app_logo_big {
  width: 128px;
  height: 128px;
  border-radius: 12px;
}

/* The timeline/step containers */
.step.developer {
  position: relative;
  padding-left: 3rem;
  margin-bottom: 2rem;
}

.step.developer::before {
  content: '';
  position: absolute;
  left: 1.25rem;  
  top: 0;
  height: 100%;
  width: 2px;
  background-color: #dee2e6;
  z-index: 0;
}

/* The circle icons on the timeline */
.circle {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.5rem;
  height: 2.5rem;
  background: white;
  border-radius: 50%;
  position: absolute;
  left: 0;
  top: 0;
  transform: translateX(0);
  font-size: 1.2rem;
  border: 2px solid transparent;
  z-index: 1;
  color: white;
}

/* Icon colors */
.circle.storage {
  background: #2ecc71;  /* Green for storage/security */
  border-color: #27ae60;
}

.circle.bitcoin {
  background: #f7931a;  /* Bitcoin orange */
  border-color: #e07d16;
}

.circle.reserves {
  background: #3498db;  /* Blue for financial/reserves */
  border-color: #2980b9;
}

.circle.leadership {
  background: #9b59b6;  /* Purple for leadership */
  border-color: #8e44ad;
}

.circle.operations {
  background: #e74c3c;  /* Red for operations */
  border-color: #c0392b;
}

.circle.business {
  background: #34495e;  /* Dark blue for business */
  border-color: #2c3e50;
}

.circle.ecosystem {
  background: #1abc9c;  /* Turquoise for ecosystem */
  border-color: #16a085;
}

.circle.access {
  background: #f1c40f;  /* Yellow for access */
  border-color: #f39c12;
}

.circle.security {
  background: #7f8c8d;  /* Gray for security */
  border-color: #95a5a6;
}

/* Add a subtle shadow and glow effect */
.circle i {
  text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
}

.circle::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border-radius: 50%;
  background: inherit;
  filter: blur(8px);
  opacity: 0.15;
  z-index: -1;
}

/* Title area for each step */
.step.developer .title h3 {
  margin-top: 0;
}
.textbox {
  background: #e9edf7;
  border-radius: 8px;
  padding: 1rem;
  margin-top: 0.5rem;
}

/* The status badges (published / not published) etc. */
.status {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
  font-weight: 500;
}
.status.published,
.status.supported {
  color: #198754;
}
.status.not-published,
.status.not-supported {
  color: #dc3545;
}
.status i {
  margin-right: 0.5rem;
}

/* Additional styling for sub-blocks */
.last-updated {
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}
.details {
  margin-top: 0.5rem;
  line-height: 1.4;
  color: #333;
}
.docs-link, .verify-link {
  margin-top: 1rem;
  display: inline-block;
  font-size: 0.9rem;
  text-decoration: none;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  border: 1px solid #ccc;
  color: #0056b3;
}
.docs-link:hover, .verify-link:hover {
  background: #dee2e6;
}

/* “Apps” listing */
.see-also {
  margin-top: 1.5rem;
}

.app-link {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  background-color: #b5c1db;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  text-decoration: none;
  color: #212529;
  transition: all 0.2s ease-in-out;
}

.app-link:hover {
  background-color: #a3b0cf;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.app-content {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.app-content i {
  font-size: 1.2rem;
}

.app-store {
  font-size: 0.8rem;
  color: #212529;
  padding: 0.35rem 0.75rem;
  background-color: white;
  border-radius: 4px;
  font-weight: 500;
  transition: background-color 0.2s ease-in-out;
}

.app-link:hover .app-store {
  background-color: #f8f9fa;
}

.bitcoin-status {
  margin-bottom: 1rem;
}
.badge {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  color: #fff;
  font-size: 0.85rem;
}
.bitcoin-only {
  background-color: #f7931a;
}
.bitcoin-optimized {
  background-color: #0d6efd;
}

/* Contributions “active” tags */
.contributions ul {
  display: flex;
  gap: 1rem;
  padding-left: 0;
  list-style: none;
}
.contributions li {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  background: #f8f9fa;
}
.contributions li.active {
  background: #198754;
  color: white;
}
</style>
