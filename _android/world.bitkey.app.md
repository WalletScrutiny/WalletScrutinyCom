---
wsId: bitkeyBlock
title: Bitkey - Bitcoin Wallet
altTitle: 
authors:
- danny
users: 1000
appId: world.bitkey.app
appCountry: US
released: 2024-02-28
updated: 2024-04-23
version: 2024.55.0 (2)
stars: 4.3
ratings: 
reviews: 6
size: 
website: https://bitkey.world
repository: https://github.com/proto-at-block/bitkey
issue: 
icon: world.bitkey.app.png
bugbounty: 
meta: ok
verdict: reproducible
date: 2024-03-23
signer: 
reviewArchive: 
twitter: Bitkeyofficial
social:
- https://www.linkedin.com/company/bitkey-official
- https://www.facebook.com/profile.php?id=100088526238789
- https://www.instagram.com/ownbitkey
redirect_from: 
developerName: Block, Inc.
features:
- multiSignature

---

**Disclaimer**: The WalletScrutiny project is sponsored by Spiral, a subsidiary of Block.

<iframe width="560" height="315" src="https://www.youtube.com/embed/pZ-Yi7A-o_A?si=cP6zKgW7r-JosAb-" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## Analysis 

This is the **companion app** to the {% include walletLink.html wallet='hardware/blockhww' verdict='true' %}. It requires an NFC-capable phone, otherwise the app would not be installed.

The setup process involves:

- Opening the app and choosing "Set up new wallet". Without the hardware device, it would not be possible to set up a new wallet. The alternate option is "More Options".
    - More Options:
        - If the user selects More Options, the user can: 
           - Accept an Invite to be a trusted contact (An invite code generated by a bitkey holder is required)
           - Recover your wallet. If the user is on Android, this requires signing in to Google Drive. 
           - Import your wallet. Use the user's Emergency Access Kit to import the wallet. There is a mobile key code that is stored in the Emergency Access Kit which can be inputted in a field.
           - The Emergency Access Kit is a PDF document located in the device's cloud backup. It can be scanned with a QR code, or the details can be entered manually.
- Pair the hardware device with the app using NFC (no initial charging required).

- Once paired with a bitkey HWW this product can function as a wallet.

### Recovery Options

Here are the available recovery options [offered by Bitkey.](https://support.bitkey.world/hc/en-us/articles/18801968949652-What-recovery-methods-are-available  )

>  - [Cloud recovery](https://support.bitkey.world/hc/en-us/articles/18842210239764): Lost/Replaced phone with cloud backup available
>
>  - [Delay + Notify](https://support.bitkey.world/hc/en-us/articles/18842292452500):
>
>    - Lost/Replaced phone without cloud backup available
>
>    - Lost/Replaced hardware device with/without cloud backup available
>
>  - [Cloud Health Check](https://support.bitkey.world/hc/en-us/articles/24491938926484): Lost/Replaced Cloud account
>
>  - [Trusted Contacts:](https://support.bitkey.world/hc/en-us/articles/24395098961940) Lost/Replaced BOTH hardware device and phone, near the same time
>
>  - [Emergency Access Kit](https://support.bitkey.world/hc/en-us/articles/24395170222868): Bitkey app unavailable in app store(s)

<hr>

## Verified Builds

This is the [documentation](https://github.com/proto-at-block/bitkey/blob/main/app/verifiable-build/android/README.md) for the build process for the Bitkey Android app, and these are the [preparation instructions](https://github.com/proto-at-block/bitkey/blob/main/app/verifiable-build/android/README.md#prep-work).

## The Commands for Verifying According to BitKey's Instructions

1. Clone the bitkey repository

    ```
    git clone https://github.com/proto-at-block/bitkey.git
    cd bitkey
    git submodule update --init --recursive
    ```

2. Activate Hermit

    ```
    source bin/activate-hermit
    ```

3. Download bundletool

    ```
    curl -L -o bundletool.jar https://github.com/google/bundletool/releases/download/1.15.6/bundletool-all-1.15.6.jar
    export BUNDLETOOL="$(pwd)/bundletool.jar"
    ```

4. Export AAPT2

    ```
    export AAPT2="$ANDROID_HOME/build-tools/34.0.0
    ```

5. Connect your phone using USB and make sure it's authorized for USB debugging

    ```
    app/verifiable-build/android/verification/verify-android-apk
    ```

The contents of this script are as follows: 

    ```
    #!/bin/bash

    # Verifies that an APK installed on a real device was build from the given source code.
    # The script assumes that there is an established ADB session with a phone that contains the app to verify.
    # The build directory is used for temporary storage and is not deleted afterwards so that the user can inspect the outputs of each verification step or do certain steps manually.

    if [ "$#" -ne 2 ]; then
        echo "Usage: $0 <path-to-bitkey-repository-directory> <path-to-build-directory>" >&2
        exit 1
    fi

    if [ ! -f "$1/app/verifiable-build/android/Dockerfile" ]; then
        echo "Cannot find the Dockerfile used for building the AAB. Ensure the path points to the root directory of the Bitkey repository." >&2
        echo "Usage: $0 <path-to-bitkey-repository-directory> <path-to-build-directory>" >&2
        exit 2
    fi

    if [ -e "$2" ]; then
      echo "Provided build directory '$2' already exists. Please delete it before running the script again." >&2
      exit 3
    fi

    package_name="world.bitkey.app"

    mkdir -p "$2"

    steps_path="$1/app/verifiable-build/android/verification/steps"

    printf "Downloading APK from phone:\n\n"
    "$steps_path/download-apk-from-phone" "$package_name" "$2/from-device/downloaded" || exit $?

    printf "Normalizing names of downloaded APKs:\n\n"
    "$steps_path/normalize-apk-names-new" "$2/from-device/downloaded" "$2/from-device/normalized-names" "device" || exit $?

    printf "Unpacking downloaded APKs:\n\n"
    "$steps_path/unpack-apks" "$2/from-device/normalized-names" "$2/from-device/unpacked" || exit $?

    printf "Normalizing content of downloaded APKs:\n\n"
    "$steps_path/normalize-apk-content" "$2/from-device/unpacked" "$2/from-device/comparable" || exit $?

    reproducible_build_variables=$(find "$2/from-device/unpacked" -type f -name "reproducible-build-variables.json" -exec cat {} \;)

    printf "Building AAB from source code:\n\n"
    "$steps_path/build-android-verification-aab" "$1" "$2/locally-built/aab" "$reproducible_build_variables" || exit $?

    aab_path=$(find "$2/locally-built/aab" -type f -name "*.aab")

    printf "Converting AAB to APKs:\n\n"
    "$steps_path/convert-aab-to-apks" "$aab_path" "$2/locally-built/apks" || exit $?

    printf "Normalizing names of locally built APKs:\n\n"
    "$steps_path/normalize-apk-names-new" "$2/locally-built/apks" "$2/locally-built/normalized-names" "bundletool" || exit $?

    printf "Unpacking locally built APKs:\n\n"
    "$steps_path/unpack-apks" "$2/locally-built/normalized-names" "$2/locally-built/unpacked" || exit $?

    printf "Normalizing content of locally built APKs:\n\n"
    "$steps_path/normalize-apk-content" "$2/locally-built/unpacked" "$2/locally-built/comparable" || exit $?

    printf "\n\n---------------------------\n\n"
    printf "Comparing builds:\n\n"
    "$steps_path/compare-apks-new" "$2/from-device" "$2/locally-built" || exit $?
    ```


## The Results of the Bitkey Verification Script

```
---------------------------

Comparing builds:

+ '[' 2 -ne 2 ']'
+ which diff
+ which /opt/android-sdk/build-tools/34.0.0/aapt2
+ lhs_comparable=verify-apk/from-device/comparable
+ lhs_apks=verify-apk/from-device/normalized-names
+ rhs_comparable=verify-apk/locally-built/comparable
+ rhs_apks=verify-apk/locally-built/normalized-names
++ find verify-apk/from-device/normalized-names -maxdepth 1 -mindepth 1 -type f -exec basename '{}' ';'
+ lhs_apk_files='xxhdpi.apk
en.apk
arm64_v8a.apk
base.apk'
++ find verify-apk/locally-built/normalized-names -maxdepth 1 -mindepth 1 -type f -exec basename '{}' ';'
+ rhs_apk_files='xxhdpi.apk
en.apk
arm64_v8a.apk
base.apk'
+++ echo 'xxhdpi.apk
en.apk
arm64_v8a.apk
base.apk'
++ sort -u /dev/fd/63 /dev/fd/62
+++ echo 'xxhdpi.apk
en.apk
arm64_v8a.apk
base.apk'
+ all_apk_files='arm64_v8a.apk
base.apk
en.apk
xxhdpi.apk'
++ diff -x resources.arsc -r verify-apk/from-device/comparable verify-apk/locally-built/comparable
+ differences=
+ diff_exit_status=0
+ diff_result=0
+ declare -a aapt_differences
+ for apk_file in $all_apk_files
+ '[' '!' -f verify-apk/from-device/normalized-names/arm64_v8a.apk ']'
+ '[' '!' -f verify-apk/locally-built/normalized-names/arm64_v8a.apk ']'
+ unzip -l verify-apk/from-device/normalized-names/arm64_v8a.apk resources.arsc
Archive:  verify-apk/from-device/normalized-names/arm64_v8a.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
---------                     -------
        0                     0 files
+ lhs_contains_resources_exit_code=11
+ unzip -l verify-apk/locally-built/normalized-names/arm64_v8a.apk resources.arsc
Archive:  verify-apk/locally-built/normalized-names/arm64_v8a.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
---------                     -------
        0                     0 files
+ rhs_contains_resources_exit_code=11
+ '[' 11 -ne 0 ']'
+ '[' 11 -eq 0 ']'
+ '[' 11 -eq 0 ']'
+ echo 'Skipping aapt2 diff of arm64_v8a.apk as it doesn'\''t contain resources.arsc file'
Skipping aapt2 diff of arm64_v8a.apk as it doesn't contain resources.arsc file
+ for apk_file in $all_apk_files
+ '[' '!' -f verify-apk/from-device/normalized-names/base.apk ']'
+ '[' '!' -f verify-apk/locally-built/normalized-names/base.apk ']'
+ unzip -l verify-apk/from-device/normalized-names/base.apk resources.arsc
Archive:  verify-apk/from-device/normalized-names/base.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
   155468  1981-01-01 01:01   resources.arsc
---------                     -------
   155468                     1 file
+ lhs_contains_resources_exit_code=0
+ unzip -l verify-apk/locally-built/normalized-names/base.apk resources.arsc
Archive:  verify-apk/locally-built/normalized-names/base.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
   155468  1981-01-01 01:01   resources.arsc
---------                     -------
   155468                     1 file
+ rhs_contains_resources_exit_code=0
+ '[' 0 -ne 0 ']'
+ '[' 0 -ne 0 ']'
++ /opt/android-sdk/build-tools/34.0.0/aapt2 diff verify-apk/from-device/normalized-names/base.apk verify-apk/locally-built/normalized-names/base.apk
+ aapt_difference=
+ aapt_diff_exit_status=0
+ '[' '' '!=' '' ']'
+ diff_result=0
+ for apk_file in $all_apk_files
+ '[' '!' -f verify-apk/from-device/normalized-names/en.apk ']'
+ '[' '!' -f verify-apk/locally-built/normalized-names/en.apk ']'
+ unzip -l verify-apk/from-device/normalized-names/en.apk resources.arsc
Archive:  verify-apk/from-device/normalized-names/en.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
    58028  1981-01-01 01:01   resources.arsc
---------                     -------
    58028                     1 file
+ lhs_contains_resources_exit_code=0
+ unzip -l verify-apk/locally-built/normalized-names/en.apk resources.arsc
Archive:  verify-apk/locally-built/normalized-names/en.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
    58028  1981-01-01 01:01   resources.arsc
---------                     -------
    58028                     1 file
+ rhs_contains_resources_exit_code=0
+ '[' 0 -ne 0 ']'
+ '[' 0 -ne 0 ']'
++ /opt/android-sdk/build-tools/34.0.0/aapt2 diff verify-apk/from-device/normalized-names/en.apk verify-apk/locally-built/normalized-names/en.apk
+ aapt_difference=
+ aapt_diff_exit_status=0
+ '[' '' '!=' '' ']'
+ diff_result=0
+ for apk_file in $all_apk_files
+ '[' '!' -f verify-apk/from-device/normalized-names/xxhdpi.apk ']'
+ '[' '!' -f verify-apk/locally-built/normalized-names/xxhdpi.apk ']'
+ unzip -l verify-apk/from-device/normalized-names/xxhdpi.apk resources.arsc
Archive:  verify-apk/from-device/normalized-names/xxhdpi.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
    11792  1981-01-01 01:01   resources.arsc
---------                     -------
    11792                     1 file
+ lhs_contains_resources_exit_code=0
+ unzip -l verify-apk/locally-built/normalized-names/xxhdpi.apk resources.arsc
Archive:  verify-apk/locally-built/normalized-names/xxhdpi.apk
  Length      Date    Time    Name
---------  ---------- -----   ----
    11792  1981-01-01 01:01   resources.arsc
---------                     -------
    11792                     1 file
+ rhs_contains_resources_exit_code=0
+ '[' 0 -ne 0 ']'
+ '[' 0 -ne 0 ']'
++ /opt/android-sdk/build-tools/34.0.0/aapt2 diff verify-apk/from-device/normalized-names/xxhdpi.apk verify-apk/locally-built/normalized-names/xxhdpi.apk
+ aapt_difference=
+ aapt_diff_exit_status=0
+ '[' '' '!=' '' ']'
+ diff_result=0
+ '[' 0 -eq 0 ']'
+ echo 'The builds are identical!'
The builds are identical!
```

A recording of the test:

{% include asciicast %}

## Notes on the Bitkey Build 

Bitkey acknowledges the difference between apks extracted from AABs. More about this can be read [here](https://github.com/proto-at-block/bitkey/blob/main/app/verifiable-build/android/README.md#verification-notes):

  > Although Google Play should be using bundletool, APKs extracted from an AAB differ in more than just a signature.
  >
  > As mentioned above, we noticed a mismatch between language APKs downloaded by Google Play and those produced by bundletool. We use the --connected-device flag when invoking bundletool build-apks, which should produce the same set of APKs. However, looking at the output of bundletool get-device-spec, the supportedLocales list is often missing some languages that Google Play downloaded to the device.
  >
  > Another such difference are names of extracted APKs. We use the normalize-apk-names-new script to rename APK files to matching names.
  resources.arsc mismatch
  >
  > Until recently, once we normalized the APK names and contents, we could just run diff -r to check for identity. Unfortunately Google Play has changed how they build resources.arsc. From our testing, it seems like they are using a previously reserved byte. When built using bundletool, that byte is always 0, thus making direct comparison using diff impossible.
  >
  > Since resources are important part of the application, we're using aapt2 diff to check for differences between APKs from device and from bundletool.

## Further Tests

The current testing process involves extracting an APK from a device and then comparing this to a built APK. 

- We first run `apktool d base-master.apk -o base-master/`, which is the built apk. 
- We then run `apktool d Bitkey.apk -o Bitkey/`, which is the apk we extracted from our phone
- We then run `diff base-master/ Bitkey/` and these are the results: 

```
$ diff base-master/ Bitkey/
diff base-master/AndroidManifest.xml Bitkey/AndroidManifest.xml
1c1
< <?xml version="1.0" encoding="utf-8" standalone="no"?><manifest xmlns:android="http://schemas.android.com/apk/res/android" android:compileSdkVersion="34" android:compileSdkVersionCodename="14" package="world.bitkey.app" platformBuildVersionCode="34" platformBuildVersionName="14">
---
> <?xml version="1.0" encoding="utf-8" standalone="no"?><manifest xmlns:android="http://schemas.android.com/apk/res/android" xmlns:n1="http://schemas.android.com/apk/distribution" android:compileSdkVersion="34" android:compileSdkVersionCodename="14" n1:requiredSplitTypes="base__abi,base__density" n1:splitTypes="" package="world.bitkey.app" platformBuildVersionCode="34" platformBuildVersionName="14">
154a155,156
>         <meta-data android:name="com.android.stamp.source" android:value="https://play.google.com/store"/>
>         <meta-data android:name="com.android.stamp.type" android:value="STAMP_TYPE_DISTRIBUTION_APK"/>
155a158
>         <meta-data android:name="com.android.vending.derived.apk.id" android:value="3"/>
diff base-master/apktool.yml Bitkey/apktool.yml
2c2
< apkFileName: base-master.apk
---
> apkFileName: Bitkey.apk
160a161
>   stamp-cert-sha256: '8'
Common subdirectories: base-master/assets and Bitkey/assets
Common subdirectories: base-master/kotlin and Bitkey/kotlin
Common subdirectories: base-master/META-INF and Bitkey/META-INF
Common subdirectories: base-master/original and Bitkey/original
Common subdirectories: base-master/res and Bitkey/res
Common subdirectories: base-master/smali and Bitkey/smali
Common subdirectories: base-master/smali_classes2 and Bitkey/smali_classes2
Common subdirectories: base-master/smali_classes3 and Bitkey/smali_classes3
Common subdirectories: base-master/unknown and Bitkey/unknown
```
- We then run `diffoscope base-master/ Bitkey/`, but the results were too big, so we [uploaded the results](https://drive.google.com/file/d/10k5H3HzmKEEnCZa9AoUY8WfhO4kfTxCG/view?usp=sharing).

## Conclusion

According to the build script provided by bitkey, the built apk and the apk from our test mobile device are identical with no significant differences. 

Our own analysis reflects this: 

- `xmlns:n1="http://schemas.android.com/apk/distribution` is present in the apk from Google Play. It is an XML namespace manifest
- `n1:requiredSplitTypes="base__abi,base__density` and `n1:splitTypes=""` related to app bundle configurations

App meta-data elements:

- `com.android.stamp.source` - the value points to Google Play Store. [Related information](https://support.google.com/googleplay/android-developer/answer/9842756?hl=en)
- `com.android.stamp.type` - points to `STAMP_TYPE_DISTRIBUTION_APK`. 
- `com.android.vending.derived.apk.id` - with a value of 3

The three are related to how Google Play processes the apk. 

- `stamp-cert-sha256` - with a value of `8`. SHA-256 hash value of a certificate used for stamping the APK

The diffs are expected given Google Play's app bundling mechanism, apk signing, and other packaging-related processes.
We can conclude that the app is **reproducible**. For more in-depth comparison, please see the [diffoscope results](https://drive.google.com/file/d/10k5H3HzmKEEnCZa9AoUY8WfhO4kfTxCG/view?usp=sharing).
